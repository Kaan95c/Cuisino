import React, { createContext, useContext, useEffect, useMemo, useState } from 'react';
import AsyncStorage from '@react-native-async-storage/async-storage';

export type Locale = 'fr' | 'en' | 'de' | 'zh' | 'ja';

interface LanguageContextValue {
  locale: Locale;
  setLocale: (l: Locale) => Promise<void>;
  t: (key: string) => string;
}

const LanguageContext = createContext<LanguageContextValue | undefined>(undefined);
const STORAGE_KEY = 'appLocale';

const STRINGS: Record<Locale, Record<string, string>> = {
  fr: {
    tabs_home: 'Accueil',
    tabs_add: 'Publier',
    tabs_profile: 'Profil',
    header_home: 'Cuisino',
    header_add: 'Nouvelle recette',
    header_profile: 'Mon profil',
    settings_title: 'ParamÃ¨tres',
    settings_appearance: 'Apparence',
    settings_language: 'Langue',
    settings_change_language: 'Changer la langue',
    settings_account: 'Compte',
    settings_view_profile: 'Voir mon profil',
    settings_theme: 'ThÃ¨me',
    settings_theme_description: 'Choisissez votre thÃ¨me prÃ©fÃ©rÃ©',
    settings_color_scheme: 'SchÃ©ma de couleurs',
    settings_color_scheme_description: 'Personnalisez l\'apparence de l\'app',
    settings_profile_description: 'GÃ©rez votre profil et vos recettes',
    settings_about: 'Ã€ propos',
    settings_version: 'Version',
    theme_system: 'SystÃ¨me',
    theme_light: 'Clair',
    theme_dark: 'Sombre',
    search_placeholder: 'Rechercher des recettes...',
    search_suggestions: 'Suggestions',
    home_hero_title: 'Cuisino',
    home_hero_sub: 'Partage tes recettes comme sur Instagram, pensÃ©e pour la cuisine.',
    chips_all: 'Tous',
    chips_dessert: 'Dessert',
    chips_breakfast: 'Petit-dÃ©j',
    chips_italian: 'Italien',
    chips_vegan: 'Vegan',
    chips_drinks: 'Boissons',
    chips_fast: 'Rapide',
    empty_no_recipes: 'Aucune recette trouvÃ©e',
    empty_hint_search: "Ajuste ta recherche ou explore d'autres catÃ©gories",
    empty_hint_default: 'Tire pour rafraÃ®chir ou ajoute ta premiÃ¨re recette !',
    ingredients: 'IngrÃ©dients',
    presentation: 'PrÃ©sentation',
    steps: 'Ã‰tapes',
    share: 'Partager',
    likes: 'likes',
    servings: 'pers.',
    minutes: 'min',
    just_now: 'Ã€ l\'instant',
    h: 'h',
    d: 'j',
    w: 's',
    profile_recipes: 'Recettes',
    profile_likes: 'Likes',
    profile_saved: 'EnregistrÃ©es',
    profile_edit: 'Ã‰diter le profil',
    profile_add_first: 'Ajouter ma premiÃ¨re recette',
    add_title: 'Titre de la recette',
    add_title_ph: 'Entrer un titre...',
    add_desc: 'Description',
    add_desc_ph: 'DÃ©cris ta recette...',
    add_ingredients: 'IngrÃ©dients',
    add_instructions: 'Ã‰tapes',
    add_step: 'Ã‰tape',
    add_publish: 'Publier la recette',
    add_publishing: 'Publication...',
    alert_error: 'Erreur',
    alert_ok: 'OK',
    alert_success: 'SuccÃ¨s ! ğŸ‰',
    alert_published: 'Ta recette a Ã©tÃ© publiÃ©e !',
    pick_tap_photo: 'Appuie pour ajouter une photo',
  },
  en: {
    tabs_home: 'Home',
    tabs_add: 'Add',
    tabs_profile: 'Profile',
    header_home: 'Cuisino',
    header_add: 'New Recipe',
    header_profile: 'My Profile',
    settings_title: 'Settings',
    settings_appearance: 'Appearance',
    settings_language: 'Language',
    settings_change_language: 'Change language',
    settings_account: 'Account',
    settings_view_profile: 'View my profile',
    theme_system: 'System',
    theme_light: 'Light',
    theme_dark: 'Dark',
    search_placeholder: 'Search recipes...',
    home_hero_title: 'Cuisino',
    home_hero_sub: 'Share recipes like Instagram, designed for cooking.',
    chips_all: 'All',
    chips_dessert: 'Dessert',
    chips_breakfast: 'Breakfast',
    chips_italian: 'Italian',
    chips_vegan: 'Vegan',
    chips_drinks: 'Drinks',
    chips_fast: 'Quick',
    empty_no_recipes: 'No recipes found',
    empty_hint_search: 'Adjust your search or explore other categories',
    empty_hint_default: 'Pull to refresh or add your first recipe!',
    ingredients: 'Ingredients',
    presentation: 'Overview',
    steps: 'Steps',
    share: 'Share',
    likes: 'likes',
    servings: 'servings',
    minutes: 'min',
    just_now: 'Just now',
    h: 'h',
    d: 'd',
    w: 'w',
    profile_recipes: 'Recipes',
    profile_likes: 'Likes',
    profile_saved: 'Saved',
    profile_edit: 'Edit Profile',
    profile_add_first: 'Add Your First Recipe',
    add_title: 'Recipe Title',
    add_title_ph: 'Enter recipe title...',
    add_desc: 'Description',
    add_desc_ph: 'Describe your recipe...',
    add_ingredients: 'Ingredients',
    add_instructions: 'Instructions',
    add_step: 'Step',
    add_publish: 'Publish Recipe',
    add_publishing: 'Publishing...',
    alert_error: 'Error',
    alert_ok: 'OK',
    alert_success: 'Success! ğŸ‰',
    alert_published: 'Your recipe has been published!',
    pick_tap_photo: 'Tap to add photo',
  },
  de: {
    tabs_home: 'Start',
    tabs_add: 'Neu',
    tabs_profile: 'Profil',
    header_home: 'Cuisino',
    header_add: 'Neues Rezept',
    header_profile: 'Mein Profil',
    settings_title: 'Einstellungen',
    settings_appearance: 'Darstellung',
    settings_language: 'Sprache',
    settings_change_language: 'Sprache Ã¤ndern',
    settings_account: 'Konto',
    settings_view_profile: 'Profil anzeigen',
    theme_system: 'System',
    theme_light: 'Hell',
    theme_dark: 'Dunkel',
    search_placeholder: 'Rezepte suchen...',
    home_hero_title: 'Cuisino',
    home_hero_sub: 'Teile Rezepte wie auf Instagram â€“ fÃ¼rs Kochen gedacht.',
    chips_all: 'Alle',
    chips_dessert: 'Dessert',
    chips_breakfast: 'FrÃ¼hstÃ¼ck',
    chips_italian: 'Italienisch',
    chips_vegan: 'Vegan',
    chips_drinks: 'GetrÃ¤nke',
    chips_fast: 'Schnell',
    empty_no_recipes: 'Keine Rezepte gefunden',
    empty_hint_search: 'Suche anpassen oder andere Kategorien ansehen',
    empty_hint_default: 'Zum Aktualisieren ziehen oder erstes Rezept hinzufÃ¼gen!',
    ingredients: 'Zutaten',
    presentation: 'Ãœbersicht',
    steps: 'Schritte',
    share: 'Teilen',
    likes: 'Likes',
    servings: 'Portionen',
    minutes: 'Min',
    just_now: 'Gerade eben',
    h: 'Std',
    d: 'Tg',
    w: 'Wo',
    profile_recipes: 'Rezepte',
    profile_likes: 'Likes',
    profile_saved: 'Gespeichert',
    profile_edit: 'Profil bearbeiten',
    profile_add_first: 'Erstes Rezept hinzufÃ¼gen',
    add_title: 'Rezepttitel',
    add_title_ph: 'Rezepttitel eingeben...',
    add_desc: 'Beschreibung',
    add_desc_ph: 'Beschreibe dein Rezept...',
    add_ingredients: 'Zutaten',
    add_instructions: 'Anleitung',
    add_step: 'Schritt',
    add_publish: 'Rezept verÃ¶ffentlichen',
    add_publishing: 'VerÃ¶ffentliche...',
    alert_error: 'Fehler',
    alert_ok: 'OK',
    alert_success: 'Erfolg! ğŸ‰',
    alert_published: 'Dein Rezept wurde verÃ¶ffentlicht!',
    pick_tap_photo: 'Zum HinzufÃ¼gen tippen',
  },
  zh: {
    tabs_home: 'é¦–é¡µ',
    tabs_add: 'å‘å¸ƒ',
    tabs_profile: 'ä¸ªäºº',
    header_home: 'Cuisino',
    header_add: 'æ–°é£Ÿè°±',
    header_profile: 'æˆ‘çš„èµ„æ–™',
    settings_title: 'è®¾ç½®',
    settings_appearance: 'å¤–è§‚',
    settings_language: 'è¯­è¨€',
    settings_change_language: 'æ›´æ”¹è¯­è¨€',
    settings_account: 'è´¦æˆ·',
    settings_view_profile: 'æŸ¥çœ‹æˆ‘çš„èµ„æ–™',
    theme_system: 'ç³»ç»Ÿ',
    theme_light: 'æµ…è‰²',
    theme_dark: 'æ·±è‰²',
    search_placeholder: 'æœç´¢é£Ÿè°±...',
    home_hero_title: 'Cuisino',
    home_hero_sub: 'åƒ Instagram ä¸€æ ·åˆ†äº«é£Ÿè°±ï¼Œæ›´é€‚åˆçƒ¹é¥ªã€‚',
    chips_all: 'å…¨éƒ¨',
    chips_dessert: 'ç”œç‚¹',
    chips_breakfast: 'æ—©é¤',
    chips_italian: 'æ„å¼',
    chips_vegan: 'çº¯ç´ ',
    chips_drinks: 'é¥®å“',
    chips_fast: 'å¿«é€Ÿ',
    empty_no_recipes: 'æœªæ‰¾åˆ°é£Ÿè°±',
    empty_hint_search: 'è°ƒæ•´æœç´¢æˆ–æµè§ˆå…¶ä»–åˆ†ç±»',
    empty_hint_default: 'ä¸‹æ‹‰åˆ·æ–°æˆ–æ·»åŠ ä½ çš„ç¬¬ä¸€é“èœï¼',
    ingredients: 'é…æ–™',
    presentation: 'ä»‹ç»',
    steps: 'æ­¥éª¤',
    share: 'åˆ†äº«',
    likes: 'å–œæ¬¢',
    servings: 'äººä»½',
    minutes: 'åˆ†é’Ÿ',
    just_now: 'åˆšåˆš',
    h: 'å°æ—¶',
    d: 'å¤©',
    w: 'å‘¨',
    profile_recipes: 'é£Ÿè°±',
    profile_likes: 'å–œæ¬¢',
    profile_saved: 'å·²ä¿å­˜',
    profile_edit: 'ç¼–è¾‘èµ„æ–™',
    profile_add_first: 'æ·»åŠ æˆ‘çš„ç¬¬ä¸€ä¸ªé£Ÿè°±',
    add_title: 'èœè°±æ ‡é¢˜',
    add_title_ph: 'è¾“å…¥æ ‡é¢˜...',
    add_desc: 'æè¿°',
    add_desc_ph: 'æè¿°ä½ çš„èœè°±...',
    add_ingredients: 'é…æ–™',
    add_instructions: 'æ­¥éª¤',
    add_step: 'æ­¥éª¤',
    add_publish: 'å‘å¸ƒèœè°±',
    add_publishing: 'å‘å¸ƒä¸­...',
    alert_error: 'é”™è¯¯',
    alert_ok: 'ç¡®å®š',
    alert_success: 'æˆåŠŸï¼ğŸ‰',
    alert_published: 'ä½ çš„èœè°±å·²å‘å¸ƒï¼',
    pick_tap_photo: 'ç‚¹å‡»æ·»åŠ ç…§ç‰‡',
  },
  ja: {
    tabs_home: 'ãƒ›ãƒ¼ãƒ ',
    tabs_add: 'æŠ•ç¨¿',
    tabs_profile: 'ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«',
    header_home: 'Cuisino',
    header_add: 'æ–°è¦ãƒ¬ã‚·ãƒ”',
    header_profile: 'ãƒã‚¤ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«',
    settings_title: 'è¨­å®š',
    settings_appearance: 'å¤–è¦³',
    settings_language: 'è¨€èª',
    settings_change_language: 'è¨€èªã‚’å¤‰æ›´',
    settings_account: 'ã‚¢ã‚«ã‚¦ãƒ³ãƒˆ',
    settings_view_profile: 'ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ã‚’è¦‹ã‚‹',
    theme_system: 'ã‚·ã‚¹ãƒ†ãƒ ',
    theme_light: 'ãƒ©ã‚¤ãƒˆ',
    theme_dark: 'ãƒ€ãƒ¼ã‚¯',
    search_placeholder: 'ãƒ¬ã‚·ãƒ”ã‚’æ¤œç´¢...',
    home_hero_title: 'Cuisino',
    home_hero_sub: 'Instagramã®ã‚ˆã†ã«ãƒ¬ã‚·ãƒ”ã‚’å…±æœ‰ã€æ–™ç†ã«æœ€é©ã€‚',
    chips_all: 'ã™ã¹ã¦',
    chips_dessert: 'ãƒ‡ã‚¶ãƒ¼ãƒˆ',
    chips_breakfast: 'æœé£Ÿ',
    chips_italian: 'ã‚¤ã‚¿ãƒªã‚¢ãƒ³',
    chips_vegan: 'ãƒ“ãƒ¼ã‚¬ãƒ³',
    chips_drinks: 'ãƒ‰ãƒªãƒ³ã‚¯',
    chips_fast: 'æ™‚çŸ­',
    empty_no_recipes: 'ãƒ¬ã‚·ãƒ”ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“',
    empty_hint_search: 'æ¤œç´¢ã‚’èª¿æ•´ã™ã‚‹ã‹ä»–ã®ã‚«ãƒ†ã‚´ãƒªã‚’æ¢ã™',
    empty_hint_default: 'å¼•ã£å¼µã£ã¦æ›´æ–°ã€ã¾ãŸã¯æœ€åˆã®ãƒ¬ã‚·ãƒ”ã‚’è¿½åŠ ï¼',
    ingredients: 'ææ–™',
    presentation: 'æ¦‚è¦',
    steps: 'æ‰‹é †',
    share: 'å…±æœ‰',
    likes: 'ã„ã„ã­',
    servings: 'äººåˆ†',
    minutes: 'åˆ†',
    just_now: 'ãŸã£ãŸä»Š',
    h: 'æ™‚é–“',
    d: 'æ—¥',
    w: 'é€±',
    profile_recipes: 'ãƒ¬ã‚·ãƒ”',
    profile_likes: 'ã„ã„ã­',
    profile_saved: 'ä¿å­˜æ¸ˆã¿',
    profile_edit: 'ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ã‚’ç·¨é›†',
    profile_add_first: 'æœ€åˆã®ãƒ¬ã‚·ãƒ”ã‚’è¿½åŠ ',
    add_title: 'ãƒ¬ã‚·ãƒ”å',
    add_title_ph: 'ã‚¿ã‚¤ãƒˆãƒ«ã‚’å…¥åŠ›...',
    add_desc: 'èª¬æ˜',
    add_desc_ph: 'ãƒ¬ã‚·ãƒ”ã‚’èª¬æ˜...',
    add_ingredients: 'ææ–™',
    add_instructions: 'æ‰‹é †',
    add_step: 'æ‰‹é †',
    add_publish: 'ãƒ¬ã‚·ãƒ”ã‚’æŠ•ç¨¿',
    add_publishing: 'æŠ•ç¨¿ä¸­...',
    alert_error: 'ã‚¨ãƒ©ãƒ¼',
    alert_ok: 'OK',
    alert_success: 'æˆåŠŸï¼ğŸ‰',
    alert_published: 'ãƒ¬ã‚·ãƒ”ã‚’å…¬é–‹ã—ã¾ã—ãŸï¼',
    pick_tap_photo: 'ã‚¿ãƒƒãƒ—ã—ã¦å†™çœŸã‚’è¿½åŠ ',
  },
};

export function LanguageProvider({ children }: { children: React.ReactNode }) {
  const [locale, setLocaleState] = useState<Locale>('fr');

  useEffect(() => {
    (async () => {
      const saved = await AsyncStorage.getItem(STORAGE_KEY);
      if (saved === 'fr' || saved === 'en' || saved === 'de' || saved === 'zh' || saved === 'ja') {
        setLocaleState(saved);
      }
    })();
  }, []);

  const setLocale = async (l: Locale) => {
    setLocaleState(l);
    await AsyncStorage.setItem(STORAGE_KEY, l);
  };

  const t = (key: string) => STRINGS[locale][key] ?? key;

  const value: LanguageContextValue = useMemo(() => ({ locale, setLocale, t }), [locale]);

  return <LanguageContext.Provider value={value}>{children}</LanguageContext.Provider>;
}

export function useLanguage() {
  const ctx = useContext(LanguageContext);
  if (!ctx) throw new Error('useLanguage must be used within LanguageProvider');
  return ctx;
} 